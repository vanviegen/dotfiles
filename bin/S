#!/bin/sh

if [ "${1#*:}" != "$1" ]; then # First arg starts with :
	TARGET_USER="${1#:}"
	shift
else
	TARGET_USER=root
fi

rm -f ~/.sudo-env.tmp
for X in PATH SSH_CLIENT SSH_CONNECTION SSH_TTY ; do
	V="$(eval "echo \$$X")"
	if [ "$V" != "" ] ; then
		echo "set -gx $X '$V'" >> ~/.sudo-env.tmp
	fi
done

sudo -u $TARGET_USER ~/.dotfiles/bin/start-env "$@"
