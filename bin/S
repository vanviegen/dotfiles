#!/bin/sh

if [ "${1#*:}" != "$1" ]; then # First arg starts with :
	TARGET_USER="${1#:}"
	shift
else
	TARGET_USER=root
fi

rm -f ~/.sudo-env.tmp
for X in PATH SSH_CLIENT SSH_CONNECTION SSH_TTY ; do
	echo "set -gx $X '$(eval "echo \$$X")'" >> ~/.sudo-env.tmp
done

sudo -u $TARGET_USER ~/.dotfiles/bin/start-env "$@"
